<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>7th Chord Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing:border-box; margin:0; padding:0; }

body {
  font-family: system-ui, sans-serif;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  background:linear-gradient(180deg,#1c1c1e,#2a2a45);
  color:#fff;
}

/* ---------- HEADER ---------- */
header {
  padding:3rem 1rem 2rem; /* reduced bottom padding for less space */
  text-align:center;
}

h1 {
  margin-bottom:2rem;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:0.7rem;
  font-size:3.2rem;
  font-weight:900;
  color:#c77dff;
  letter-spacing:0.05em;
  text-shadow:0 3px 10px rgba(0,0,0,0.5);
}

h1 span { font-size:3.5rem; }

/* ---------- CONTROL PANEL ---------- */
.control-container {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:1.5rem;
}

.control-panel {
  display:flex;
  gap:2rem;
  padding:1.7rem 2.4rem;
  border-radius:24px;
  background:linear-gradient(135deg,#2d2d35,#3a3a45);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.05),
    0 14px 36px rgba(0,0,0,0.6);
  flex-wrap:wrap;
}

/* ---------- MODES ---------- */
.mode-selector {
  display:flex;
  flex-direction:column;
  gap:0.8rem;
  font-size:1.15rem;
  font-weight:700;
}

.mode-selector label {
  display:flex;
  align-items:center;
  gap:0.6rem;
  cursor:pointer;
}

.mode-selector input {
  accent-color:#ffd166;
  transform:scale(1.2);
}

/* ---------- BUTTONS ---------- */
.button-column {
  display:flex;
  flex-direction:column;
  gap:1rem;
}

button {
  font-weight:800;
  cursor:pointer;
  border:none;
  outline:none;
  transition: transform 0.12s ease, box-shadow 0.15s;
  color:#1c1c1e;
}

button:disabled {
  opacity:0.4;
  cursor:not-allowed;
  box-shadow:none;
}

/* Play */
.play {
  background:#4cc9f0;
  padding:0.6rem 1.6rem;
  font-size:1.3rem;
  border-radius:14px;
  box-shadow:0 6px 0 #3295b3;
}

/* Stats */
.stats-btn {
  background:#e0e0e0;
  padding:0.6rem 1.6rem;
  font-size:1.3rem;
  border-radius:14px;
  box-shadow:0 6px 0 #bcbcbc;
}

/* ---------- NEXT (PRIMARY) ---------- */
.next-row {
  margin-top:1.5rem;
}

.next-btn {
  background:#ff6f61;
  box-shadow:0 7px 0 #cc5547;
  font-size:1.8rem;
  padding:0.9rem 3rem;
  border-radius:50px;
  letter-spacing:0.05em;
}

/* ---------- INFO ---------- */
.info-box {
  display:flex;
  gap:1rem;
  margin-top:1rem;
  font-size:1.2rem;
  font-weight:800;
}

.pill {
  padding:0.35rem 0.9rem;
  border-radius:999px;
}

.pill.key  { background:#9d4edd; }
.pill.step { background:#4361ee; }

/* ---------- STATS LINE ---------- */
.stats-line {
  font-size:1.05rem;
  font-weight:700;
  color:#ffd166;
  text-shadow:0 1px 3px rgba(0,0,0,0.5);
  margin-bottom:1rem;
}

/* ---------- MAIN ---------- */
main {
  flex:1;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  margin-top:0.5rem;
  padding:1rem;
}

.chord {
  font-size:clamp(6rem, 13vw, 20rem);
  font-weight:900;
  white-space:nowrap;
  line-height:1;
  color: #ffffff;
  text-shadow: 0 2px 6px rgba(0,0,0,0.5);
}

/* ---------- ANTICIPATION ANIMATION ---------- */
button.anticipate {
  transform: scale(1.12);
}

sup { font-size:0.5em; }
.qual { font-size:0.6em; }
</style>
</head>

<body>

<header>
  <h1><span>ðŸŽ·</span>7th Chord Generator</h1>

  <div class="control-container">

    <div class="control-panel">

      <div class="mode-selector">
        <label><input type="radio" name="mode" value="random" checked> Random</label>
        <label><input type="radio" name="mode" value="major"> iiâ€“Vâ€“I (major)</label>
        <label><input type="radio" name="mode" value="minor"> iiÃ¸â€“Vâ€“i (minor)</label>
        <label><input type="radio" name="mode" value="cycle"> Cycle-of-Fifths</label>
      </div>

      <div class="button-column">
        <button id="playBtn" class="play" disabled>â–¶ Play</button>
        <button id="statsBtn" class="stats-btn">ðŸ“Š Stats</button>
      </div>

    </div>

    <!-- ---------- STATS LINE ---------- -->
    <div class="stats-line" id="statsLine" style="display:none;">
      Chords generated: <span id="count">0</span>
    </div>

    <div class="next-row">
      <button id="nextBtn" class="next-btn">ðŸŽµ Next</button>
    </div>

    <div class="info-box" id="infoBox" style="display:none;">
      <span class="pill key" id="keyPill"></span>
      <span class="pill step" id="stepPill"></span>
    </div>

  </div>
</header>

<main>
  <div class="chord" id="display">ðŸŽµ</div>
</main>

<script>
"use strict";

/* ---------- DOM ---------- */
const display = document.getElementById("display");
const nextBtn = document.getElementById("nextBtn");
const playBtn = document.getElementById("playBtn");
const statsBtn = document.getElementById("statsBtn");
const infoBox = document.getElementById("infoBox");
const keyPill = document.getElementById("keyPill");
const stepPill = document.getElementById("stepPill");
const statsLine = document.getElementById("statsLine");
const countEl = document.getElementById("count");
const radios = document.querySelectorAll("input[name='mode']");

/* ---------- STATE ---------- */
let audioCtx = null;
let currentChord = null;
let currentKey = null;
let stepIndex = 0;
let mode = "random";
let count = 0;
let statsVisible = false;
let hasChord = false;

/* ---------- HELPERS ---------- */
function setPlayEnabled(enabled){
  playBtn.disabled = !enabled;
  hasChord = enabled;
}

function anticipate(btn){
  if(btn.disabled) return;
  btn.classList.add("anticipate");
  setTimeout(()=>btn.classList.remove("anticipate"),120);
}

/* ---------- MUSIC ---------- */
const roots = ["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];
const freqs = { C:261.63,Db:277.18,D:293.66,Eb:311.13,E:329.63,F:349.23,Gb:369.99,G:392,Ab:415.3,A:440,Bb:466.16,B:493.88 };
const intervals = { "7":[0,4,7,10],"maj7":[0,4,7,11],"m7":[0,3,7,10],"Ã¸7":[0,3,6,10],"o7":[0,3,6,9] };

const iiVIMajor = [{deg:"ii",q:"m7",off:2},{deg:"V",q:"7",off:7},{deg:"I",q:"maj7",off:0}];
const iiVIMinor = [{deg:"iiÃ¸",q:"Ã¸7",off:2},{deg:"V",q:"7",off:7},{deg:"i",q:"m7",off:0}];

function buildChord(r,q){
  return { root:r, quality:q, notes:intervals[q].map(i=>freqs[r]*Math.pow(2,i/12)) };
}

function formatChord(c){
  const r = c.root.includes("b") ? `${c.root[0]}<sup>b</sup>` : c.root;
  if (c.quality==="7") return `${r}<sup>7</sup>`;
  if (c.quality==="maj7") return `${r}<span class="qual">maj</span><sup>7</sup>`;
  if (c.quality==="m7") return `${r}<span class="qual">m</span><sup>7</sup>`;
  return `${r}<sup>${c.quality}</sup>`;
}

/* ---------- GENERATE ---------- */
function nextChord(){
  if(nextBtn.disabled) return;

  if(mode==="cycle"){
    if(!currentKey) currentKey="C";
    const q = Object.keys(intervals)[Math.floor(Math.random()*5)];
    currentChord = buildChord(currentKey,q);
    currentKey = roots[(roots.indexOf(currentKey)-7+12)%12]; // down a 5th
    infoBox.style.display="none";
  } else {
    if(mode==="random"){
      currentChord = buildChord(
        roots[Math.floor(Math.random()*12)],
        Object.keys(intervals)[Math.floor(Math.random()*5)]
      );
      infoBox.style.display="none";
    } else {
      if(!currentKey||stepIndex===0) currentKey=roots[Math.floor(Math.random()*12)];
      const seq = mode==="major"?iiVIMajor:iiVIMinor;
      const s = seq[stepIndex];
      currentChord = buildChord(roots[(roots.indexOf(currentKey)+s.off)%12],s.q);
      keyPill.textContent=`Key: ${currentKey}`;
      stepPill.textContent=`Step: ${s.deg}`;
      infoBox.style.display="flex";
      stepIndex=(stepIndex+1)%3;
    }
  }

  display.innerHTML=formatChord(currentChord);
  setPlayEnabled(true);
  count++;
  if(statsVisible) {
    statsLine.style.display="block";
    countEl.textContent=count;
  }
  nextBtn.focus();
}

/* ---------- AUDIO ---------- */
function playChord(c){
  if(!hasChord || !c) return;
  if(!audioCtx) audioCtx=new AudioContext();
  const t=audioCtx.currentTime, step=0.2;

  c.notes.forEach((f,i)=>{
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.frequency.value=f; o.connect(g).connect(audioCtx.destination);
    g.gain.setValueAtTime(0,t+i*step);
    g.gain.linearRampToValueAtTime(0.25,t+i*step+0.05);
    g.gain.linearRampToValueAtTime(0,t+i*step+1);
    o.start(t+i*step); o.stop(t+i*step+1);
  });
}

/* ---------- EVENTS ---------- */
nextBtn.addEventListener("click", nextChord);
playBtn.addEventListener("click", ()=>{ if(hasChord) playChord(currentChord); });
statsBtn.addEventListener("click", ()=>{
  statsVisible=!statsVisible;
  statsLine.style.display=statsVisible?"block":"none";
  countEl.textContent=count;
});

/* ---------- ANTICIPATION ON PRESS ---------- */
[nextBtn, playBtn, statsBtn].forEach(btn=>{
  btn.addEventListener("mousedown", ()=>anticipate(btn));
});

/* ---------- RADIO BUTTONS ---------- */
radios.forEach(r=>r.onchange=()=>{
  mode=r.value;
  currentKey=null;
  stepIndex=0;
  currentChord=null;
  display.innerHTML="ðŸŽµ";
  infoBox.style.display="none";
  setPlayEnabled(false);
});

/* ---------- GLOBAL KEYS ---------- */
document.addEventListener("keydown", e=>{
  if(e.code==="Space"){
    e.preventDefault();
    anticipate(nextBtn);
    nextChord();
  }
  if(e.key==="p"){
    e.preventDefault();
    anticipate(playBtn);
    if(hasChord) playChord(currentChord);
  }
  if(e.key==="s"){
    e.preventDefault();
    anticipate(statsBtn);
    statsVisible=!statsVisible;
    statsLine.style.display=statsVisible?"block":"none";
    countEl.textContent=count;
  }
});
</script>

</body>
</html>

